---------------------------------
--JORGE SAGRERO-PEREZ
---------------------------------
CREATE TABLE CUSTOMER (FIRST_NAME VARCHAR2(50), LAST_NAME VARCHAR2(50), PHONE_NUMBER NUMBER(20),  
EMAIL VARCHAR2(50), HOME_ADDRESS VARCHAR2(50), CUSTOMER_ID NUMBER(20)CONSTRAINT PK_CUSTOMER PRIMARY KEY 
);
CREATE TABLE INVOICE (INVOICE_ID NUMBER(20), INVOICE_DATE VARCHAR2(30), 
CUSTOMER_ID NUMBER(20) CONSTRAINT FK_INVOICE_CUSTOMER REFERENCES CUSTOMER ,
AMOUNT NUMBER (5,2) 
);

------------------
--INSERT DATA
------------------
SET DEFINE OFF

INSERT INTO CUSTOMER (PHONE_NUMBER, FIRST_NAME, LAST_NAME, EMAIL, HOME_ADDRESS, CUSTOMER_ID) 
VALUES (5354838488, 'Pennie', 'Bedin', 'pbedin0@mashable.com', '32 Green Center', 167909235);

INSERT INTO CUSTOMER (PHONE_NUMBER, FIRST_NAME, LAST_NAME, EMAIL, HOME_ADDRESS, CUSTOMER_ID) 
VALUES (3706209867, 'Galvan', 'Eymer', 'geymer1@hc360.com', '33 Farwell Avenue', 999842178);

INSERT INTO CUSTOMER (PHONE_NUMBER, FIRST_NAME, LAST_NAME, EMAIL, HOME_ADDRESS, CUSTOMER_ID) 
VALUES (8736073809, 'Cherianne', 'Webberley', 'cwebberley2@merriamwebster.com', '2 Mallard Parkway', 423198438);

INSERT INTO CUSTOMER (PHONE_NUMBER, FIRST_NAME, LAST_NAME, EMAIL, HOME_ADDRESS, CUSTOMER_ID) 
VALUES (8198649203, 'Roddy', 'Helmke', 'rhelmke3@sphinn.com', '96665 Blaine Trail', 487023785);

INSERT INTO CUSTOMER (PHONE_NUMBER, FIRST_NAME, LAST_NAME, EMAIL, HOME_ADDRESS, CUSTOMER_ID) 
VALUES (7333587644, 'Harriett', 'Gerrie', 'hgerrie4@ocn.ne.jp', '6 American Road', 103244949);

INSERT INTO CUSTOMER (PHONE_NUMBER, FIRST_NAME, LAST_NAME, EMAIL, HOME_ADDRESS, CUSTOMER_ID) 
VALUES (2173093171, 'Muriel', 'Fearnall', 'mfearnall5@sitemeter.com', '4054 Declaration Park', 654158069);

INSERT INTO CUSTOMER (PHONE_NUMBER, FIRST_NAME, LAST_NAME, EMAIL, HOME_ADDRESS, CUSTOMER_ID) 
VALUES (9139927129, 'Sebastiano', 'Finney', 'sfinney6@businessinsider.com', '19 Heath Road', 512347650);

INSERT INTO CUSTOMER (PHONE_NUMBER, FIRST_NAME, LAST_NAME, EMAIL, HOME_ADDRESS, CUSTOMER_ID) 
VALUES (4262719290, 'Millisent', 'Speechley', 'mspeechley7@thetimes.co.uk', '21482 Lighthouse Bay Place', 886468068);

INSERT INTO CUSTOMER (PHONE_NUMBER, FIRST_NAME, LAST_NAME, EMAIL, HOME_ADDRESS, CUSTOMER_ID) 
VALUES (3969237197, 'Laurens', 'Secker', 'lsecker8@cisco.com', '3766 Dorton Trail', 819525047);

INSERT INTO CUSTOMER (PHONE_NUMBER, FIRST_NAME, LAST_NAME, EMAIL, HOME_ADDRESS, CUSTOMER_ID) 
VALUES (4614248877, 'Wyatt', 'Albert', 'walbert9@google.com.hk', '24 Transport Pass', 084824994);

INSERT INTO CUSTOMER (PHONE_NUMBER, FIRST_NAME, LAST_NAME, EMAIL, HOME_ADDRESS, CUSTOMER_ID) 
VALUES (4444444444, 'Shepard', 'Williams', 'n7@gmail.com', '72 Normandy Pass', 000091111);

INSERT INTO CUSTOMER (PHONE_NUMBER, FIRST_NAME, LAST_NAME, EMAIL, HOME_ADDRESS, CUSTOMER_ID) 
VALUES (3333333333, NULL,NULL, 'Fereldan@cicso.com', '97 Kirkwall Road', 000009999);

SET DEFINE OFF

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (1.0, '2017-09-24 04:42:42', 084824994, 70.94);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (2.0, '2018-06-29 01:06:23', 084824994, 933.93);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (3.0, '2017-12-06 11:31:14', 084824994, 515.91);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (4.0, '2017-11-24 17:34:00', 819525047, 548.0);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (5.0, '2018-03-09 01:47:55', 999842178, 991.22);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (6.0, '2017-09-16 07:31:39', 886468068, 100.38);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (7.0, '2018-05-27 23:17:23', 886468068, 582.84);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (8.0, '2018-07-11 22:52:54', 103244949, 161.47);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (9.0, '2018-03-30 09:40:45', 654158069, 691.48);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (10.0, '2018-05-29 15:00:27', 103244949, 876.13);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (11.0, '2018-03-25 06:04:17', 886468068, 784.55);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (12.0, '2017-10-04 07:37:48', 886468068, 862.04);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (13.0, '2017-12-30 00:45:53', 512347650, 239.49);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (14.0, '2017-12-11 17:25:07', 103244949, 440.45);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (15.0, '2017-11-10 07:03:04', 819525047, 179.88);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (16.0, '2017-09-02 04:49:24', 167909235, 678.4);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (17.0, '2018-01-09 03:29:10', 423198438, 758.58);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (18.0, '2017-10-09 11:03:09', 103244949, 82.67);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (19.0, '2018-04-25 04:19:06', 167909235, 874.49);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (20.0, '2018-06-04 15:00:51', 654158069, 883.4);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (21.0, '2017-09-14 16:19:11', 654158069, 753.26);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (22.0, '2018-01-13 03:00:31', 999842178, 122.92);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (23.0, '2018-06-03 15:54:34', 512347650, 482.45);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (24.0, '2018-08-09 10:11:12', 084824994, 6.53);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (25.0, '2017-09-10 17:02:24', 819525047, 623.99);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (26.0, '2018-02-25 23:09:38', 512347650, 350.82);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (27.0, '2018-03-22 16:16:40', 654158069, 397.78);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (28.0, '2017-12-20 17:38:32', 512347650, 373.86);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (29.0, '2017-11-30 08:42:23', 423198438, 824.57);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (30.0, '2017-09-01 16:15:49', 819525047, 743.56);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (31.0, '2018-02-24 03:03:51', 512347650, 59.25);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (32.0, '2017-10-28 08:36:15', 654158069, 28.78);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (33.0, '2018-08-08 00:59:32', 423198438, 900.37);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (34.0, '2018-01-20 07:38:39', 512347650, 730.33);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (35.0, '2017-09-29 16:31:43', 423198438, 722.69);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (36.0, '2018-07-09 20:16:02', 423198438, 964.31);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (37.0, '2018-04-29 21:27:59', 167909235, 472.65);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (38.0, '2018-06-27 09:27:54', 886468068, 514.88);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (39.0, '2018-04-02 10:31:15', 654158069, 117.02);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (40.0, '2018-01-25 20:53:29', 084824994, 458.5);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (41.0, '2017-11-20 07:52:12', 487023785, 967.46);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (42.0, '2018-02-15 14:20:48', 886468068, 695.82);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (43.0, '2018-03-20 10:50:17', 103244949, 154.66);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (44.0, '2018-08-10 05:50:40', 167909235, 939.43);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (45.0, '2017-09-19 16:33:16', 654158069, 820.21);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (46.0, '2018-06-24 05:41:37', 103244949, 673.75);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (47.0, '2018-02-08 10:06:32', 512347650, 908.16);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (48.0, '2018-03-09 18:26:03', 819525047, 948.13);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (49.0, '2018-07-15 06:42:11', 886468068, 156.54);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (50.0, '2017-09-13 19:39:29', 819525047, 364.74);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (NULL, NULL, 000091111, NULL);

INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) 
VALUES (52.0, '2017-09-24 04:42:42', 000009999, 23.94);




--THIS QUERY SHOWS PURCHASES THAT OCCURED TODAY
--SELECT TO_CHAR(SYSTIMESTAMP,'YYYY-MM-DD HH:MI:SS') FROM DUAL;
SELECT * FROM INVOICE
WHERE INVOICE_DATE = (SELECT TO_CHAR(SYSTIMESTAMP,'YYYY-MM-DD HH:MI:SS') FROM DUAL);

--a query which shows each customer and the number of purchases made by each

SELECT CUSTOMER.FIRST_NAME, CUSTOMER.LAST_NAME,CUSTOMER.CUSTOMER_ID, count(INVOICE.CUSTOMER_ID) as NUMBER_OF_ORDERS
FROM INVOICE
INNER JOIN CUSTOMER ON INVOICE.CUSTOMER_ID = CUSTOMER.CUSTOMER_ID
GROUP BY CUSTOMER.CUSTOMER_ID, CUSTOMER.FIRST_NAME, CUSTOMER.LAST_NAME, CUSTOMER.CUSTOMER_ID;


-- THE  QUERY THAT SHOWS THE CUSTOMER AND THE TOTAL COST OF ALL THEIR PURCHASES
SELECT CUSTOMER.FIRST_NAME, CUSTOMER.LAST_NAME,CUSTOMER.CUSTOMER_ID ,SUM(INVOICE.AMOUNT) as TOTAL_SPENT,count(INVOICE.CUSTOMER_ID) as NUMBER_OF_ORDERS
FROM INVOICE
INNER JOIN CUSTOMER ON INVOICE.CUSTOMER_ID = CUSTOMER.CUSTOMER_ID
GROUP BY CUSTOMER.CUSTOMER_ID, CUSTOMER.FIRST_NAME, CUSTOMER.LAST_NAME, CUSTOMER.CUSTOMER_ID;

--a query which returns all purchases which took place in the last month, display them in descending order
SELECT TO_CHAR(SYSTIMESTAMP,'YYYY-MM-DD HH:MI:SS') FROM DUAL;
SELECT * FROM INVOICE
WHERE INVOICE_DATE >( SELECT TO_CHAR((ADD_MONTHS(SYSDATE, -1)),'YYYY-MM-DD HH:MI:SS') FROM DUAL);

--Create a query which show the top three most expensive purchases
-- to alaise a table, just write the aliase name in front of the table since from does not support 'as'
SELECT *
FROM INVOICE 
WHERE (INVOICE.INVOICE_DATE IS NOT NULL)
ORDER BY AMOUNT DESC
FETCH FIRST 3 ROWS ONLY;


-------------
--WEDNESDAYWORK
---------------
--Create a query which returns all of the invoices which have a listed customer, but not invoices who have no customer listed and not customers who have no invoices listed

SELECT * FROM INVOICE
INNER JOIN CUSTOMER ON INVOICE.CUSTOMER_ID = CUSTOMER.CUSTOMER_ID
WHERE (((CUSTOMER.FIRST_NAME IS NOT NULL)AND (CUSTOMER.LAST_NAME IS NOT NULL))AND ((INVOICE.INVOICE_ID IS NOT NULL))) ;
--Create a query which returns all of the invoices and their customer, not invoices who have no customer listed but include customers which have no invoices listed
SELECT CUSTOMER.FIRST_NAME, CUSTOMER.LAST_NAME, INVOICE.* FROM INVOICE
INNER JOIN CUSTOMER ON INVOICE.CUSTOMER_ID = CUSTOMER.CUSTOMER_ID
WHERE ((CUSTOMER.FIRST_NAME IS NOT NULL)AND (CUSTOMER.LAST_NAME IS NOT NULL));
--Create a query which shows each record in the invoice table, along with the name of the customer
SELECT  CUSTOMER.FIRST_NAME, CUSTOMER.LAST_NAME, INVOICE.* FROM INVOICE
JOIN CUSTOMER ON INVOICE.CUSTOMER_ID = CUSTOMER.CUSTOMER_ID;


--Create a query which shows the name of each customer and the total amount they have spent
SELECT CUSTOMER.FIRST_NAME, CUSTOMER.LAST_NAME,SUM(INVOICE.AMOUNT) TOTAL_SPENT
FROM INVOICE
JOIN CUSTOMER ON INVOICE.CUSTOMER_ID = CUSTOMER.CUSTOMER_ID
GROUP BY CUSTOMER.CUSTOMER_ID, CUSTOMER.FIRST_NAME, CUSTOMER.LAST_NAME, CUSTOMER.CUSTOMER_ID;

--Create a query which returns the record of the customer who made the most recent purchase
/*
select * 
from table_name 
order by trans_date desc
fetch first 1 row only;
*/
SELECT *
FROM INVOICE
JOIN CUSTOMER ON INVOICE.CUSTOMER_ID = CUSTOMER.CUSTOMER_ID
WHERE (INVOICE.INVOICE_DATE IS NOT NULL)
ORDER BY INVOICE_DATE DESC
FETCH FIRST 1 ROWS ONLY;


--Create a query which shows the purchaser of each invoice and the subtotal of each invoice if 6% sales tax was applied to the subtotal to get the price of each invoice
SELECT CUSTOMER.FIRST_NAME, CUSTOMER.LAST_NAME, 
((INVOICE.AMOUNT*.06)+ INVOICE.AMOUNT)WITH_6_SALES_TAX,INVOICE.AMOUNT TOTAL_WITHOUT_TAX,INVOICE.*
FROM INVOICE
JOIN CUSTOMER ON INVOICE.CUSTOMER_ID = CUSTOMER.CUSTOMER_ID;


COMMIT WORK;